{
  // See https://go.microsoft.com/fwlink/?LinkId=733558
  // for the documentation about the tasks.json format
  "version": "2.0.0",
  "tasks": [
    {
      "label": "format",
      "type": "shell",
      "command": "cargo fmt",
      "problemMatcher": ["$rustc"],
      "group": "build"
    },
    {
      "label": "clippy",
      "type": "shell",
      "command": "cargo clippy ${input:projects} --all-targets",
      "problemMatcher": ["$rustc"],
      "group": "build"
    },
    {
      "label": "build",
      "type": "shell",
      "command": "cargo build --release ${input:projects} --all-targets",
      "problemMatcher": ["$rustc"],
      "group": "build"
    },
    {
      "label": "test unit",
      "type": "shell",
      "command": "cargo test ${input:projects}",
      "options": {
        "env": {
          "_RUST_LOG": "debug",
          "RUST_BACKTRACE": "full"
        }
      },
      "problemMatcher": ["$rustc"],
      "group": "build"
    },
    {
      "label": "test miri",
      "type": "shell",
      "command": "cargo miri test ${input:projects}",
      "options": {
        "env": {
          "_RUST_LOG": "debug",
          "RUST_BACKTRACE": "full"
        }
      },
      "problemMatcher": ["$rustc"],
      "group": "build"
    },
    {
      "label": "start dev environment",
      "type": "shell",
      "command": "docker compose -f docker-compose.yml -p shine up",
      "group": "build",
      "isBackground": true
    },
    {
      "label": "identity: cloud",
      "type": "shell",
      "command": "cargo run -p shine-identity --release -- prod",
      "options": {
        "cwd": "services/identity",
        "env": {
          "SERVICE--TLS--CERT": "../../certs/test.crt",
          "SERVICE--TLS--KEY": "../../certs/test.key",
          "AUTH--AUTHBASEURL": "https://local.scytta.com:7000/auth/"
        }
      },
      "problemMatcher": ["$rustc"],
      "group": "build"
    },
    {
      "label": "identity: local",
      "type": "shell",
      "command": "cargo run -p shine-identity --release -- test",
      "options": {
        "cwd": "services/identity",
        "env": {
          "RUST_BACKTRACE": "full",
          "SERVICE--TLS--CERT": "../../certs/test.crt",
          "SERVICE--TLS--KEY": "../../certs/test.key",
          "AUTH--AUTHBASEURL": "https://local.scytta.com:7000/auth/"
        }
      },
      "problemMatcher": ["$rustc"],
      "group": "build"
    },
    {
      "label": "command: cloud",
      "type": "shell",
      "command": "cargo run -p shine-command --release -- prod",
      "options": {
        "cwd": "services/command",
        "env": {
          "SERVICE--TLS--CERT": "../../certs/test.crt",
          "SERVICE--TLS--KEY": "../../certs/test.key"
        }
      },
      "problemMatcher": ["$rustc"],
      "group": "build"
    },
    {
      "label": "command: local",
      "type": "shell",
      "command": "cargo run -p shine-command --release -- test",
      "options": {
        "cwd": "services/command",
        "env": {
          "RUST_BACKTRACE": "full",
          "SERVICE--TLS--CERT": "../../certs/test.crt",
          "SERVICE--TLS--KEY": "../../certs/test.key"
        }
      },
      "problemMatcher": ["$rustc"],
      "group": "build"
    }
  ],
  "inputs": [
    {
      "type": "pickString",
      "id": "projects",
      "description": "Select project",
      "options": [
        { "label": "all", "value": "" },
        { "label": "shine-command", "value": "-p shine-command" },
        { "label": "shine-identity", "value": "-p shine-identity" },
        { "label": "shine-core", "value": "-p shine-core" },
        { "label": "shine-core-macros", "value": "-p shine-core-macros" },
        { "label": "shine-test", "value": "-p shine-test" },
        { "label": "shine-test-macros", "value": "-p shine-test-macros" }
      ],
      "default": "asset-service"
    }
  ]
}
